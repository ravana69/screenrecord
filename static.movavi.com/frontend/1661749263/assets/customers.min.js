for(var i in window.customerCalls=[],void 0!==window.customer&&(window.customerCalls=window.customer.q),window.customer=new function(){function n(e,t){this.data=e||{},this.cookie=t||{}}var r=this,a="/customers",i=!0,s=!1,o="cstm",c=1209600,d={id:"cid",ga:"_ga",utmz:"__utmz"},u={},f={},m={},l=!1,w=!1;this.Events={Load:"load",Init:"init",Agree:"agree"};function g(e){e=e||{};var t=[];for(var n in e)t.push(n+"="+encodeURIComponent(e[n]));return t.join("&")}function v(){var e={};for(var t in d){var n=x.get(d[t]);void 0!==n&&(e[t]=n)}return f.id&&(e.id=f.id),s&&(e.ga=s),document.referrer&&(e.referrer=document.referrer),e}function p(e,t){e.call(r,t)}function h(){l=!0,!x.get("_c_agree")&&i&&(x.set("_c_agree",1,{expires:63072e3,path:"/"}),r.trigger(r.Events.Agree,new n({id:f.id}))),r.trigger(r.Events.Load,new n(f,m))}function C(){w=!0,r.trigger(r.Events.Init,new n({id:f.id})),f.agreement&&h()}var x={get:function(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0},set:function(e,t,n){var o,r=(n=n||{}).expires;"number"==typeof r&&r&&((o=new Date).setTime(o.getTime()+1e3*r),r=n.expires=o),r&&r.toUTCString&&(n.expires=r.toUTCString());var i=e+"="+encodeURIComponent(t);for(var a in n){i+="; "+a;var s=n[a];!0!==s&&(i+="="+s)}document.cookie=i},remove:function(e){x.set(e,"",{expires:-1,path:"/"})}},E=function(e,t,n){e=e.split("#");var o=(t=encodeURIComponent(t))+"="+(n=encodeURIComponent(n)),r=new RegExp("(&|\\?)"+t+"=[^&]*");return e[0]=e[0].replace(r,"$1"+o),r.test(e[0])||(e[0]+=(-1!==e[0].indexOf("?")?"&":"?")+o),e[0]+(e[1]?"#"+e[1]:"")},L=function(e,t){var n=t||window.location.href,o=new RegExp("[?&]"+e+"=([^&#]*)","i").exec(n);return o?o[1]:null};this.trigger=function(e,t){if(void 0!==u[e])for(var n in u[e])p(u[e][n],t)},this.on=function(e,t){void 0===u[e]&&(u[e]=[]),e===r.Events.Init&&w&&p(t,new n({id:f.id})),e!==r.Events.Agree||i&&!x.get("_c_agree")||p(t,new n({id:f.id||x.get("cid")})),e===r.Events.Load&&l&&p(t,new n(f,m)),u[e].push(t)},this.setAgreement=function(){f.agreement||r.request({action:"set_agreement",data:v(),method:"get",success:function(e,t){f=e,m=t,h()},error:h})},this.init=function(e,t){var n,o=setTimeout(function(){void 0!==window.ga?ga(function(e){s=e.get("clientId")}):setTimeout(o,1)},1);this.syncCrossDomainIfQueryContainsData()||(void 0!==t&&(i=t),void 0!==e&&(a=e),n=v(),i&&(n.need_agreement="1"),n.with_carrot=0,-1!==window.location.href.indexOf("thank-you-for-install")&&(n.with_carrot=1),r.request({action:"visit",data:n,method:"get",success:function(e,t){f=e,m=t,C()},error:C}))},this.request=function(n){var e=new XMLHttpRequest;e.addEventListener("load",function(e){var t=JSON.parse(e.currentTarget.responseText);!0===t.success&&n.success&&n.success(t.data||{},t.cookies||{}),!1===t.success&&n.error&&n.error(t.error||"unknown error")}),void 0!==n.error&&e.addEventListener("error",n.error,function(e){n.error("unknown error")});var t,o=n.method||"GET",r=null,i=a+"/action/"+n.action;switch(o.toLowerCase()){case"get":void 0===n.data||0<(t=g(n.data)).length&&(i+=-1===i.indexOf("?")?"?":"&",i+=t);break;case"post":void 0!==n.data&&(r=g(n.data))}e.open(o,i,!0),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),"post"===o.toLowerCase()&&e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send(r)},this.getData=function(){return f},r.on(r.Events.Load,function(e){for(var t in e.cookie){var n=e.cookie[t];null===n?x.remove(t):x.set(t,n[0],{expires:n[1],path:"/"})}e.data&&e.data.agreement&&(x.set(o,JSON.stringify(e.data),{expires:c,path:"/"}),r.setCustomerInfoToCrossdomainLink())}),void 0!==document.addEventListener&&document.addEventListener("DOMContentLoaded",function(){void 0!==window.ga&&r.on(r.Events.Load,function(t){!t.data.id||t.data.ga&&t.data.last_ga===r.getData().last_ga||ga(function(e){customer.request({method:"get",action:"set_ga",data:{id:t.data.id,ga:e.get("clientId")},error:function(e){console.error(e)}})})})}),this.setCustomerInfoToCrossdomainLink=function(){var e,t,n=x.get("cstm");null!=n&&((e=JSON.parse(n)).hasOwnProperty("ip")&&(e.ip=""),n=JSON.stringify(e),t=document.querySelectorAll("a"),(t=[].slice.call(t)).forEach(function(e){e.addEventListener("mousedown",function(){r.appendCustomerDataToHref(e,n)}),e.addEventListener("keyup",function(){r.appendCustomerDataToHref(e,n)})}))},this.appendCustomerDataToHref=function(e,t){var n=e.href.match(/\/\/([^/]+)(?:\/|$)/),o=e.href.indexOf("//");o<=6&&-1<o&&-1===e.href.indexOf("//"+location.host+"/")&&0<n.length&&-1!==CMSDomains.indexOf(n[1])&&(e.href=E(e.href,"cstm",t))},this.syncCrossDomainIfQueryContainsData=function(){if(null===(t=L("cstm"))||""===t)return!1;var e=t=decodeURIComponent(t),t=JSON.parse(t);return x.set(o,e,{expires:c,path:"/"}),x.set(d.id,t.id,{expires:63072e3,path:"/"}),f=t,!0}},window.customerCalls)"init"===window.customerCalls[i][0]&&customer[window.customerCalls[i][0]].call(customer,window.customerCalls[i][1],window.customerCalls[i][2]);for(var i in window.customerCalls)"init"!==window.customerCalls[i][0]&&customer[window.customerCalls[i][0]].call(customer,window.customerCalls[i][1],window.customerCalls[i][2]);